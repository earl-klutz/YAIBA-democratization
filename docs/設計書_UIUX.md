# Colab UI/UX設計書（Cosmic Crisis 参考版）
Cosmic-Crisis-analysis-tool の設計資料で用いられている構成を参考に、YAIBA ログ可視化ツールの UI/UX 仕様を整理する。

## 1. 概要
### 1.1 目的
VRChat ギミック「YAIBA」で取得した位置情報を、プログラミング知識のないユーザーでも Google Colaboratory 上で簡単に可視化・共有できるようにする。

### 1.2 スコープ
- Colab のセル操作を通じた基本 UI
- YAIBA ログまたは中間ファイル（CSV／Parquet）のアップロード
- ヒートマップ・ヒストグラム・軌跡動画などの生成と一括ダウンロード

## 2. 利用フロー
1. **セットアップ** – 必要なライブラリをインストールするセルを実行
2. **プライバシーと同意** – データ取り扱いに関する注意事項を表示
3. **ファイル入力** – 解析対象ファイルをアップロード
4. **パラメータ設定** – 期間指定などの条件を入力
5. **実行** – 前処理から可視化・動画生成まで一括処理
6. **結果確認／ダウンロード** – 成果物の確認とダウンロード

## 3. 画面仕様
### 3.1 セットアップ
- **内容**: 依存ライブラリを `pip install` で導入
- **UI**: コードセル＋実行ボタン

### 3.2 プライバシーと同意
- **内容**: 利用規約を提示
- **UI**: テキスト表示
  > **【重要】プライバシーとデータの取り扱いについて**
  > - 本ツールは、位置情報取得に同意したユーザーのログのみを扱います。
  > - ファイルをアップロードすると、データが Google Colaboratory のサーバーに送信されることに同意したものとみなします。

### 3.3 ファイル入力
- **内容**: 対象ログまたは中間ファイルをアップロード
- **UI**: ファイル選択ボタン

### 3.4 パラメータ設定
- **内容**: 可視化条件の指定
- **UI**:
  - `[ ] 全期間を対象にする` チェックボックス（オン時は日付入力を無効化）
  - 開始・終了日時の `DatePicker`

### 3.5 実行
- **内容**: 前処理・可視化・動画生成を実施
- **UI**: 「実行」ボタン

### 3.6 結果確認とダウンロード
- **内容**: 生成物と中間データの表示および取得
- **UI**:
  - ヒートマップ画像・ヒストグラム画像・mp4 動画をインライン表示
  - `[中間データ(CSV/Parquet)をダウンロード]` ボタン
  - すべての成果物をまとめた ZIP ファイルのリンク

## 4. 入力仕様
- **データ形式**:
  1. YAIBA 生ログ (`.log`, `.txt`)
  2. 中間データ（必須カラム: `second`, `userid`, `location_x`, `location_y`, `location_z`, `event_day` など）
- **タイムゾーン**: ローカルタイムを基準とし変換は行わない

## 5. 出力仕様
### 5.1 生成物
- ヒートマップ画像 (PNG)
- 滞在時間ヒストグラム画像 (PNG)
- 軌跡動画 (mp4)
- その他統計テーブル

### 5.2 フォルダ構造
```
/content/
|-- YAIBA_data/
|   |-- input/
|   |   `-- (アップロードされたファイル)
|   |-- intermediate/
|   |   `-- (処理中に生成される中間ファイル)
|   `-- output/
|       |-- heatmap.png
|       |-- histogram.png
|       |-- trajectory.mp4
|       `-- (その他テーブル等)
`-- YAIBA_Visualizer_output.zip
```

## 6. UX ルール
- **全期間指定**: チェック時は日付入力を無効化
- **ダウンサンプリング提案**: 行数が閾値（例: 100 万行）を超える場合、間引き処理の確認ダイアログを表示

## 7. 例外・エラー処理
| カテゴリ | エラー概要 | UI 表示メッセージ例 |
|:---|:---|:---|
| **入力エラー** | ファイルが見つからない | `[入力エラー] 指定されたファイルが見つかりません。ファイルをアップロードし直してください。` |
|  | ファイル形式が不正 | `[入力エラー] 対応していないファイル形式です。YAIBAログ(.log, .txt)または標準ファイル(.csv, .parquet)をアップロードしてください。` |
|  | データフォーマットが不正 | `[入力エラー] 必須データ(時刻, ユーザーID等)が欠けています。ファイル内容を確認してください。` |
|  | データの内容が異常 | `[入力エラー] データに異常な値が含まれています。入力データを確認してください。` |
| **処理・可視化エラー** | 処理対象データなし | `[処理エラー] 条件に一致するデータがありません。パラメータを変更して再実行してください。` |
|  | グラフ生成失敗 | `[可視化エラー] グラフ生成中に問題が発生しました。詳細はログを参照してください。` |
|  | 処理タイムアウト | `[タイムアウト] 処理が時間内に完了しませんでした。データ量を減らして再実行してください。` |
| **出力エラー** | ファイル書き込み失敗 | `[出力エラー] 結果の保存に失敗しました。ディスク容量や権限を確認してください。` |
|  | 成果物未生成 | `[出力エラー] 成果物が生成されませんでした。処理ログを確認してください。` |
| **全般** | 不明なエラー | `[不明なエラー] 予期せぬ問題が発生しました。詳細はログを確認し、開発者に連絡してください。` |

## 8. 性能・品質要件
- **処理時間**: 3 時間 × 100 人 × 1 Hz のデータ（約 108 万行）を 3 分以内に処理
- **再現性**: 同じ入力とパラメータで常に同じ結果を出力
- **可用性**: Google Colaboratory が利用可能な環境であればいつでも実行可能

## 9. テスト計画
### 9.1 単体テスト
- 正常系: 仕様通りの入力で期待通りの成果物が生成されること
- 異常系: 想定外の入力で定義されたエラーが返されること

### 9.2 結合テスト
実際の YAIBA ログを用い、アップロードから成果物ダウンロードまで一連のフローを確認する。

